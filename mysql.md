# 分库分表

## 问题分析

采用单数据库进行数据存 储，存在以下性能瓶颈：

1. IO瓶颈：热点数据太多，数据库缓存不足，产生大量磁盘IO，效率较低。 请求数据太多，带宽不够，网络IO瓶颈。 
2. CPU瓶颈：排序、分组、连接查询、聚合统计等SQL会耗费大量的CPU资源，请求数太多，CPU出现瓶颈。

为了解决上述问题，我们需要对数据库进行分库分表处理。

分库分表的中心思想：将数据分散存储，使得单一数据库/表的数据量变小来缓解单一数据库的性能问题，从而达到提升数据库性能的目的。

## 拆分策略

拆分的维度：垂直拆分和水平拆分。拆分的粒度：为分库和分表。

### 垂直拆分

#### 垂直分库

<img src="https://wsb-typora-picture.oss-cn-chengdu.aliyuncs.com/picgo/202503131234255.png" alt="image-20250313123411147" style="zoom: 50%;" />

垂直分库：以表为依据，根据业务将不同表拆分到不同库中。

 特点： 每个库的表结构都不一样。 每个库的数据也不一样。 所有库的并集是全量数据。

#### 垂直分表

<img src="https://wsb-typora-picture.oss-cn-chengdu.aliyuncs.com/picgo/202503131234252.png" alt="image-20250313123457193" style="zoom:50%;" />

垂直分表：以字段为依据，根据字段属性将不同字段拆分到不同表中。

 特点： 每个表的结构都不一样。 每个表的数据也不一样，一般通过一列（主键/外键）关联。 所有表的并集是全量数据

### 水平拆分

#### 水平分库

<img src="https://wsb-typora-picture.oss-cn-chengdu.aliyuncs.com/picgo/202503131238463.png" alt="image-20250313123830423" style="zoom: 50%;" />

水平分库：以字段为依据，按照一定策略，将一个库的数据拆分到多个库中。 

特点： 每个库的表结构都一样。 每个库的数据都不一样。 所有库的并集是全量数据。

#### 水平分表

<img src="https://wsb-typora-picture.oss-cn-chengdu.aliyuncs.com/picgo/202503131239643.png" alt="image-20250313123922573" style="zoom:50%;" />

水平分表：以字段为依据，按照一定策略，将一个表的数据拆分到多个表中。 

特点： 每个表的表结构都一样。 每个表的数据都不一样。 所有表的并集是全量数据。